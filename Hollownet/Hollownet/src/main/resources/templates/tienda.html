<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda - HollowNet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Segoe+UI&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/new.css}">
    <link rel="stylesheet" th:href="@{/css/noticia.css}">
    <link rel="stylesheet" th:href="@{/css/tienda.css}">

 
</head>
<body>

<header th:replace="Header :: Encabezado"></header>

<main class="container mt-4">
    <h1 class="mb-4 text-center">Catálogo de Juegos</h1>

    <!-- Aquí está el each -->
    <div th:each="juego : ${juegos}" class="d-flex justify-content-center">
        <div class="card d-flex flex-row p-3 align-items-center">
            <!-- Texto -->
            <div class="flex-grow-1 pe-3"
                 data-bs-toggle="modal"
                 th:data-bs-target="'#modal' + ${juego.id}"
                 style="cursor:pointer;">
                <h3 class="card-title" th:text="${juego.titulo}">Título del Juego</h3>
                <h4 class="text-info mb-2" th:text="${juego.categoria}">Categoría</h4>
                <p class="card-text mb-2 fs-4" th:text="${juego.informacion}">Descripción</p>
                <span class="price-pill fs-2" th:text="${'₡' + #numbers.formatInteger(juego.precio, 0)}">₡0</span>

            </div>

            <!-- Imagen -->
            <img th:src="${juego.imagen}"
                 class="game-img"
                 th:alt="${juego.titulo}"
                 style="width:280px; height:170px; cursor:pointer;"
                 data-bs-toggle="modal"
                 th:data-bs-target="'#modal' + ${juego.id}">
        </div>

        <!-- Modal -->
        <div class="modal fade"
             th:id="'modal' + ${juego.id}"
             tabindex="-1"
             th:aria-labelledby="'modal' + ${juego.id} + 'Label'"
             aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable" style="max-height: 90vh;">
                <div class="modal-content text-white">
                    <div class="modal-header">
                        <h5 class="modal-title"
                            th:id="'modal' + ${juego.id} + 'Label'"
                            th:text="${juego.titulo}">
                            Título del Modal
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body text-start px-4 d-flex flex-column" style="min-height: auto; padding-bottom: 0;">
                        <div style="flex: 0 0 auto;">
                            <img th:src="${juego.imagen}"
                                 class="img-fluid mb-3"
                                 th:alt="${juego.titulo}"
                                 style="width: 100%; max-width: 1100px; height: auto;">

                            <h5 class="card-title mt-3" th:text="${juego.titulo}">Título del Modal (repetido)</h5>
                            <p class="card-subtitle" style="font-size: 1.3rem;" th:text="${juego.informacion}"></p>
                        </div>

                        <div style="flex: 1 1 auto; margin-top: auto; padding-top: 30px;">
                            <p class="card-text mb-4" style="color: #ccc;" th:text="${juego.informacion}"></p>

                            <div th:if="${juego.stock > 0 and juego.activo}">
                                <form th:action="@{/carrito/agregar/{id}(id=${juego.id})}" method="post" class="d-inline">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <button type="submit" class="btn btn-cart-lg">
                                        <i class="bi bi-cart-plus me-1"></i> Agregar al carrito
                                    </button>
                                </form>
                            </div>
                            <span th:if="${juego.stock <= 0 or !juego.activo}" class="badge bg-danger ms-2">
                                Sin stock
                            </span>

                            <div class="ratio ratio-16x9 mb-3"
                                 th:if="${juego.video != null and !#strings.isEmpty(juego.video)}">
                                <iframe th:src="${juego.video}"
                                        title="Trailer"
                                        frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                        referrerpolicy="strict-origin-when-cross-origin"
                                        allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
