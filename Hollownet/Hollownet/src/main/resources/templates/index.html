<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="UTF-8">
        <title>Inicio - HollowNet</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Fuentes y CSS existentes -->
        <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Segoe+UI&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="stylesheet" href="css/header.css">
        <link rel="stylesheet" href="css/slider.css">
        <link rel="stylesheet" href="css/hero.css">
        <link rel="stylesheet" href="css/new.css">
    </head>

    <body>
        <!-- ===== Header estilo adminUsuario (solo rutas MVC con th:href) ===== -->
        
        <div th:replace="Header :: EncabezadoSty"></div>
        <header th:replace="Header :: Encabezado"></header>
        
        <!-- ===== Hero ===== -->
        <section class="hero">
            <div class="hero-content vertical">
                <div class="hero-text">
                    <h2>¡Bienvenid@ a HollowNet!</h2>
                    <p>
                        La mejor tienda digital de videojuegos. Explora juegos únicos, sigue noticias y<br>
                        gestiona tu biblioteca como un verdadero gamer.
                    </p>
                    <a th:href="@{/Tienda}" class="boton-ir-tienda">Explorar Tienda</a>
                </div>
            </div>
        </section>

        <!-- ===== Título ===== -->
        <h2 style="text-align:center; font-family:'Press Start 2P', monospace; font-size: 1.2em; color: white; margin-top: 40px;">
            Juegos Destacados
        </h2>

        <!-- ===== Slider ===== -->
        <div class="slider-container">
            <div class="slider">
                <button class="slider-button prev" onclick="prevSlide()">&#10094;</button>
                <img src="images/kart.jpg" alt="Juego" id="slider-image">
                <div class="info">
                    <h2 id="slider-title">Título</h2>
                    <p id="slider-category">Categoría</p>
                    <p id="slider-price">₡0</p>
                </div>
                <button class="slider-button next" onclick="nextSlide()">&#10095;</button>
            </div>

            <div class="thumbnails" id="thumbs"></div>
        </div>

        <!-- ===== Datos Thymeleaf para slider (códigos 1,2,3) ===== -->
        <div id="slides-data" style="display:none">
            <!-- El controlador debe poner en el modelo 'destacados' (List<Juego>) con los juegos de código "1","2","3" -->
            <div class="slide"
                 th:each="g : ${destacados}"
                 th:attr="data-image=${g.imagen},
                 data-title=${g.titulo},
                 data-category=${g.categoria},
                 data-price=${#numbers.formatInteger(g.precio,0)}">
            </div>
        </div>

        <!-- ===== Slider script (lee los juegos del DOM) ===== -->
        <script>
            // Lee slides desde los nodos generados por Thymeleaf (destacados: cod 1,2,3)
            function readSlides() {
                const nodes = document.querySelectorAll('#slides-data .slide');
                const arr = [];
                nodes.forEach(n => {
                    arr.push({
                        image: n.dataset.image || 'images/kart.jpg',
                        title: n.dataset.title || 'Juego',
                        category: n.dataset.category || 'Categoría',
                        price: '₡' + (n.dataset.price || '0')
                    });
                });
                return arr;
            }

            // Fallback si el backend no envió destacados aún
            const fallback = [
                {image: 'images/kart.jpg', title: 'Kart Racing X', category: 'Carreras', price: '₡10.000'},
                {image: 'images/minecraft.jpg', title: 'Minecraft', category: 'Sandbox', price: '₡12.000'},
                {image: 'images/spyro.jpg', title: 'Spyro Remastered', category: 'Aventura', price: '₡14.000'}
            ];

            const slides = (function () {
                const data = readSlides();
                return (data && data.length) ? data : fallback;
            })();

            let currentIndex = 0;
            let sliderInterval;

            function updateSlide() {
                const s = slides[currentIndex];
                document.getElementById('slider-image').src = s.image;
                document.getElementById('slider-title').textContent = s.title;
                document.getElementById('slider-category').textContent = s.category;
                document.getElementById('slider-price').textContent = s.price;
                updateThumbsActive();
            }

            function nextSlide() {
                currentIndex = (currentIndex + 1) % slides.length;
                updateSlide();
            }
            function prevSlide() {
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                updateSlide();
            }
            function goToSlide(i) {
                currentIndex = i;
                updateSlide();
                resetInterval();
            }

            function resetInterval() {
                clearInterval(sliderInterval);
                sliderInterval = setInterval(nextSlide, 4000);
            }

            function buildThumbs() {
                const c = document.getElementById('thumbs');
                c.innerHTML = '';
                slides.forEach((s, i) => {
                    const img = document.createElement('img');
                    img.src = s.image;
                    img.className = 'thumbnail';
                    img.onclick = () => goToSlide(i);
                    c.appendChild(img);
                });
            }

            function updateThumbsActive() {
                const thumbs = document.querySelectorAll('#thumbs .thumbnail');
                thumbs.forEach((t, i) => t.classList.toggle('active', i === currentIndex));
            }

            // init
            buildThumbs();
            updateSlide();
            sliderInterval = setInterval(nextSlide, 4000);
        </script>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
